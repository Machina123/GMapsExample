<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
    <link rel="stylesheet" href="lib/jquery.mobile-1.3.2.min.css" />
    <script src="lib/jquery-1.11.1.min.js"></script>
    <script src="lib/jquery.mobile-1.3.2.min.js"></script>
    <script src="http://maps.google.com/maps/api/js?sensor=false&language=pl"></script>
    <script src="lib/gmap3.min.js"></script>
    <title>Hello World</title>
</head>
<body>
    <div data-role="page" id="main">
        <div id="optionsPanel" data-role="panel" data-position="left" data-slide-close="true" data-display="push">
            
            <input id="Rlon" type="range" min="-180" max="180" value="0" />
            <input id="Rlat" type="range" min="-90" max="90" value="0" />
            <input id="Rzoom" type="range" min="1" max="15" value="3" />
            <ul id="markerlist" data-role="listview"></ul>

        </div>
        <div data-role="header" style="height: 40px;" data-theme="b">
            <img id="menuButton" style="display: inline; position: absolute; top: 4px; left: 4px; width: 32px; height: 32px;" src="img\menu.png" alt="Menu" />
        </div>
        <div data-role="content">
            <div id="gmap"></div>

            <script>
                var listIndex = 0;
                //var db = localStorage;
                //var markers = [];
                $(document).ready(function () {
                    //markers = JSON.parse(db.getItem("markers"));
                    //listIndex = parseInt(db.getItem("listIndex"));

                    $("#gmap").width("100%").height(window.innerHeight - 75 + "px");
                    $("#gmap").gmap3({
                        map: {
                            options: {
                                latLng: [0.000, 0.000],
                                zoom: 3,
                                disableDefaultUI: true
                            },
                            events: {
                                click: function (map,event) {
                                    console.log(event);
                                    addMapMarker(event.latLng.lat(), event.latLng.lng());
                                    $("#markerlist").append("<li>Miejsce</li>");
                                    $("#markerlist").listview("refresh");
                                    listIndex++;
                                }
                            }
                        }
                });

                $("#Rlon").change(function () {
                    //alert("zmiana")
                    var latV = parseInt($("#Rlat").val());
                    var lonV = parseInt($("#Rlon").val());
                    var map = $("#gmap").gmap3({ get: "map" });

                    map.setCenter(new google.maps.LatLng(latV, lonV));
                });

                $("#Rlat").change(function () {
                    var latV = parseInt($("#Rlat").val());
                    var lonV = parseInt($("#Rlon").val());
                    var map = $("#gmap").gmap3({ get: "map" });

                    map.setCenter(new google.maps.LatLng(latV, lonV));
                });

                $("#Rzoom").change(function () {
                    var zoomV = parseInt($("#Rzoom").val());
                    var map = $("#gmap").gmap3({ get: "map" });

                    map.setZoom(zoomV);

                });

                $("#menuButton").click(function () {
                    $("#optionsPanel").panel("open");
                });

                function addMapMarker(lat, lng) {
                    $("#gmap").gmap3({
                        map: {
                            marker: {
                                options: {
                                    draggable: true
                                },
                                latLng: [lat, lng],
                            },
                        }
                    });
                    console.log(lat + " " + lng);
                }
                });

            </script>
        </div>
        <div data-role="footer" data-position="fixed">
        </div>
    </div>


</body>
</html>
